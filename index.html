<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI 網紅工具台</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="bg-orb orb-a"></div>
  <div class="bg-orb orb-b"></div>

  <header class="topbar">
    <div>
      <p class="eyebrow">AI Influencer Toolkit</p>
      <h1 id="pageTitle">工具總覽</h1>
    </div>
    <nav class="app-nav" aria-label="主導覽">
      <button class="nav-btn" data-route="home" type="button">首頁</button>
      <button class="nav-btn" data-route="dashboard" type="button">儀表板</button>
      <button class="nav-btn" data-route="content" type="button">內容素材庫</button>
    </nav>
    <div class="storage-status" id="storageStatus"></div>
  </header>

  <main class="container">
    <section class="panel save-panel">
      <div class="save-head">
        <h2>全平台存檔</h2>
        <p class="save-last-edit">最後編輯時間：<span id="lastEditedAt">--</span></p>
      </div>
      <div class="save-actions">
        <label class="role-label">
          角色編號
          <input id="roleIdInput" type="text" placeholder="例如 Amy" maxlength="30" />
        </label>
        <button id="exportBtn" type="button" class="secondary">存檔匯出</button>
        <label class="import-label">
          載入存檔
          <input id="importInput" type="file" accept="application/json" />
        </label>
        <button id="clearCacheBtn" type="button" class="danger">清除緩存</button>
      </div>
    </section>

    <section id="homePage" class="app-page active" data-page="home">
      <section class="panel hero-panel">
        <h2>工具首頁</h2>
        <p>這裡是你的 AI 網紅營運工具入口。之後可以持續新增更多頁面，例如貼文排程、內容模板、合作追蹤、素材管理。</p>
      </section>

      <section class="tool-grid">
        <article class="panel tool-card actionable" data-route="dashboard">
          <h3>儀表板</h3>
          <p>追蹤漏斗平台節點與連線，查看轉換率、增長曲線、事件標記與存檔。</p>
          <button class="ghost" type="button">進入工具</button>
        </article>
        <article class="panel tool-card coming-soon">
          <h3>貼文排程中心</h3>
          <p>規劃發文節奏與活動檔期。</p>
          <span>Coming Soon</span>
        </article>
        <article class="panel tool-card actionable" data-route="content">
          <h3>內容素材庫</h3>
          <p>記錄角色人設、Prompt、腳本、活動備註與任何營運資訊。</p>
          <button class="ghost" type="button">進入素材庫</button>
        </article>
      </section>
    </section>

    <section id="dashboardPage" class="app-page" data-page="dashboard">
      <section class="panel dashboard-subnav-panel">
        <div class="dashboard-subnav">
          <button class="nav-btn dashboard-subnav-btn" data-dashboard-tab="board" type="button">數據看板</button>
          <button class="nav-btn dashboard-subnav-btn" data-dashboard-tab="records" type="button">資料管理中心</button>
        </div>
      </section>

      <section class="dashboard-subpage" data-dashboard-subpage="board">

        <section class="panel report-panel">
          <div class="table-head">
            <h2>報告匯出</h2>
            <div class="table-tools">
              <button id="exportPdfBtn" type="button" class="ghost">匯出增長 PDF 報告</button>
            </div>
          </div>
          <p class="helper-text">依目前設定區間匯出中文 PDF 報告。</p>
        </section>

        <section class="panel chart-panel">
          <div class="chart-header">
            <div>
              <h2>增長數據</h2>
              <p>可切換單平台/多平台比較（滾輪縮放、拖拉框選縮放、Shift+拖曳平移）</p>
            </div>
            <div class="chart-controls">
              <label class="chart-inline-field">
                顯示模式
                <select id="trendModeSelect">
                  <option value="single">單平台顯示</option>
                  <option value="multi">多平台比較</option>
                </select>
              </label>
              <label class="chart-inline-field" id="trendSingleStageWrap">
                平台
                <select id="trendSingleStageSelect"></select>
              </label>
              <div id="trendStageMultiOptions" class="trend-stage-multi-options"></div>
              <label class="chart-toggle">
                <input id="showNoteLines" type="checkbox" checked />
                顯示備註事件線
              </label>
              <button id="resetZoomBtn" type="button" class="ghost">重設縮放</button>
            </div>
          </div>
          <div class="chart-wrap">
            <canvas id="trendCanvas"></canvas>
          </div>
          <div class="kpi-grid kpi-grid-growth" id="growthKpiGrid"></div>
          <div class="platform-kpi-grid" id="platformKpiGrid"></div>
          <div class="chart-range-row">
            <label>
              區間
              <select id="trendRangeSelect">
                <option value="today">今日</option>
                <option value="7d">近 7 天</option>
                <option value="30d" selected>近 30 天</option>
                <option value="custom">自訂</option>
              </select>
            </label>
            <label>
              開始
              <input id="trendStartDate" type="datetime-local" disabled />
            </label>
            <label>
              結束
              <input id="trendEndDate" type="datetime-local" disabled />
            </label>
            <button id="applyTrendRangeBtn" type="button">套用</button>
          </div>
        </section>

        <section class="panel chart-panel">
          <div class="chart-header">
            <div>
              <h2>轉換率</h2>
              <p>整體轉換率趨勢（單位：天，%）</p>
            </div>
            <div class="chart-controls">
              <button id="resetConversionZoomBtn" type="button" class="ghost">重設縮放</button>
            </div>
          </div>
          <div class="chart-wrap">
            <canvas id="conversionTrendCanvas"></canvas>
          </div>
          <div class="chart-range-row">
            <label>
              區間
              <select id="conversionRangeSelect">
                <option value="today">今日</option>
                <option value="7d">近 7 天</option>
                <option value="30d" selected>近 30 天</option>
                <option value="custom">自訂</option>
              </select>
            </label>
            <label>
              開始
              <input id="conversionStartDate" type="datetime-local" disabled />
            </label>
            <label>
              結束
              <input id="conversionEndDate" type="datetime-local" disabled />
            </label>
            <button id="applyConversionRangeBtn" type="button">套用</button>
          </div>
        </section>
      </section>

      <section class="dashboard-subpage" data-dashboard-subpage="records">
        <div class="records-top-grid">
          <section class="panel funnel-snapshot-panel">
            <h2>新增快照</h2>
            <form id="funnelSnapshotForm">
              <label>
                時間
                <input id="funnelDatetimeInput" type="datetime-local" step="60" required />
              </label>
              <div id="funnelStageInputs" class="funnel-stage-inputs"></div>
              <label>
                備註
                <input id="funnelNoteInput" type="text" maxlength="80" placeholder="可填活動或貼文事件" />
              </label>
              <div class="actions">
                <button id="saveFunnelSnapshotBtn" type="submit">儲存快照</button>
                <button id="resetFunnelSnapshotBtn" type="button" class="secondary">清空</button>
              </div>
            </form>
          </section>

          <section class="panel funnel-panel" id="funnelPanel">
            <div class="table-head">
              <h2>資料輸入與平台設定</h2>
            </div>
            <section class="funnel-config">
              <h3>平台設定</h3>
              <p class="helper-text">拖曳卡片可直接調整平台順序；平台關係以箭頭連線為準。</p>
              <div class="funnel-stage-add">
                <input id="funnelStageNameInput" type="text" maxlength="40" placeholder="例如：IG、Discord、Telegram" />
                <button id="addFunnelStageBtn" type="button" class="secondary">新增平台</button>
              </div>
              <div class="funnel-link-toolbar">
                <button id="toggleLinkModeBtn" type="button" class="ghost">連線模式：關閉</button>
                <div class="funnel-canvas-zoom">
                  <button id="funnelZoomOutBtn" type="button" class="ghost" aria-label="縮小畫布">-</button>
                  <span id="funnelZoomLabel">100%</span>
                  <button id="funnelZoomInBtn" type="button" class="ghost" aria-label="放大畫布">+</button>
                  <button id="funnelZoomResetBtn" type="button" class="ghost">重設</button>
                </div>
                <span id="linkModeStatus" class="helper-text">提示：開啟後，依序點兩個節點建立/取消箭頭；點箭頭可刪除</span>
              </div>
              <div class="funnel-graph" id="funnelGraphCanvas">
                <svg id="funnelGraphSvg" class="funnel-graph-svg" aria-hidden="true"></svg>
                <div id="funnelStageList" class="funnel-stage-list"></div>
              </div>
            </section>
            <section class="funnel-summary" id="funnelSummaryBody"></section>
          </section>
        </div>

        <section class="panel table-panel">
          <div class="table-head">
            <h2>紀錄列表</h2>
            <div class="table-tools">
              <label class="search-label">
                搜尋
                <input id="recordSearchInput" type="text" placeholder="時間 / 備註 / 數值" />
              </label>
              <label class="sort-label">
                排序
                <select id="sortOrderSelect">
                  <option value="time_desc" selected>時間降冪</option>
                  <option value="time_asc">時間升冪</option>
                </select>
              </label>
              <button id="clearAllRecordsBtn" type="button" class="danger">全部刪除</button>
            </div>
          </div>
          <div class="table-wrap">
            <table>
              <thead id="recordTableHead">
                <tr>
                  <th>時間</th>
                  <th>平台</th>
                  <th>備註</th>
                  <th>事件線</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="recordTableBody"></tbody>
            </table>
          </div>
        </section>
      </section>

    </section>

    <section hidden aria-hidden="true">
      <form id="recordForm">
        <input id="datetimeInput" type="datetime-local" />
        <input id="threadsInput" type="number" />
        <input id="lineInput" type="number" />
        <input id="noteInput" type="text" />
        <span id="stage1FormLabel"></span>
        <span id="stage2FormLabel"></span>
        <button id="saveRecordBtn" type="submit"></button>
        <button id="resetFormBtn" type="button"></button>
      </form>
    </section>

    <section id="contentPage" class="app-page" data-page="content">
      <section class="content-top-split">
        <section class="panel content-viewer-panel content-viewer-standalone">
          <div class="content-viewer-head">
            <h2 id="contentViewerTitle">請先選擇素材</h2>
            <p id="contentViewerMeta">-</p>
          </div>
          <p class="content-viewer-tags" id="contentViewerTags">-</p>
          <p class="content-viewer-ref">
            參考連結：
            <a id="contentViewerRefLink" href="#" target="_blank" rel="noopener noreferrer"></a>
            <span id="contentViewerRefEmpty">-</span>
          </p>
          <article class="content-viewer-body" id="contentViewerBody">尚未選擇任何素材。</article>
        </section>

        <section class="panel form-panel content-form-panel">
          <h2 id="contentFormTitle">新增素材</h2>
          <form id="contentForm">
            <div class="grid-4">
              <label>
                項目名稱
                <input id="contentTitleInput" type="text" maxlength="80" placeholder="例如：Amy 人設 v2" required />
              </label>
              <label>
                類型
                <input id="contentTypeInput" type="text" maxlength="50" placeholder="例如：人設 / Prompt / 腳本 / 備忘" />
              </label>
              <label>
                標籤
                <input id="contentTagsInput" type="text" maxlength="80" placeholder="例如：amy, threads, 轉換" />
              </label>
              <label>
                參考連結（可空）
                <input id="contentRefInput" type="text" maxlength="2048" placeholder="例如：https://..." />
              </label>
            </div>
            <label>
              內容
              <textarea id="contentBodyInput" rows="6" placeholder="可自由記錄任何內容..." required></textarea>
            </label>
            <div class="actions">
              <button id="saveContentBtn" type="submit">儲存素材</button>
              <button id="resetContentBtn" type="button" class="secondary">清空</button>
            </div>
          </form>
        </section>
      </section>

      <section class="panel table-panel content-list-panel">
        <div class="table-head">
          <h2>素材列表</h2>
          <div class="table-tools">
            <label class="search-label">
              搜尋
              <input id="contentSearchInput" type="text" placeholder="名稱 / 類型 / 標籤 / 內容" />
            </label>
            <button id="clearAllContentBtn" type="button" class="danger">全部刪除</button>
          </div>
        </div>
        <div class="table-wrap">
          <table class="content-table">
            <thead>
              <tr>
                <th>名稱</th>
                <th>類型</th>
                <th>標籤</th>
                <th>更新時間</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="contentTableBody"></tbody>
          </table>
        </div>
      </section>
    </section>
  </main>

  <template id="rowTemplate">
    <tr>
      <td data-col="dt"></td>
      <td data-col="threads"></td>
      <td data-col="line"></td>
      <td data-col="note"></td>
      <td data-col="noteLine"></td>
      <td class="row-actions">
        <button class="ghost" data-action="edit">編輯</button>
        <button class="danger" data-action="delete">刪除</button>
      </td>
    </tr>
  </template>

  <template id="contentRowTemplate">
    <tr>
      <td data-col="title"></td>
      <td data-col="type"></td>
      <td data-col="tags"></td>
      <td data-col="updated"></td>
      <td class="row-actions">
        <button class="ghost" data-action="view-content">查看</button>
        <button class="ghost" data-action="edit-content">編輯</button>
        <button class="danger" data-action="delete-content">刪除</button>
      </td>
    </tr>
  </template>

  <script src="vendor/chart.umd.min.js"></script>
  <script src="vendor/hammer.min.js"></script>
  <script src="vendor/chartjs-plugin-zoom.min.js"></script>
  <script src="vendor/jspdf.umd.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
